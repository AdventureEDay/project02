<html>

<head>
  <script src="../jbrowse-linear-view.js"></script>
</head>

<body>
  <!-- <h1>We're using JBrowse Linear View!</h1> -->
  <div id="jbrowse_linear_view"></div>
  <button data-type="gene_button" data-location="10:94762681..94855547">
    CYP2C19
  </button>
  <button data-type="gene_button" data-location="13:32315086..32400266">
    BRCA2
  </button>
  <input type="text"></input>
  <script type="module">
    import assembly from './assembly.js'
    import tracks from './tracks.js'

    let defaultSession = {
      name: 'aNameHere', // what the name is doesn't really matter
      view: {
        "id": "linearGenomeView",
        "type": "LinearGenomeView",
        // "offsetPx": -308,
        // "bpPerPx": 40,
        "displayedRegions": [
          {
            "refName": "chr10",
            "start": 100987269,
            "end": 133797422,
            "reversed": false,
            "assemblyName": "GRCh38"
          }
        ],
        "tracks": [],
        // "hideHeader": false,
        // "hideHeaderOverview": false,
        // "trackSelectorType": "hierarchical",
        // "showTrackLabels": true,
        // "showCenterLine": false
      },
    }

    const updates = document.getElementById('update')
    const genomeView = new JBrowseLinearView({
      container: document.getElementById('jbrowse_linear_view'),
      assembly,
      tracks,
      // location: '1:100,987,269..100,987,368',
      defaultSession,
      onChange: patch => {
        // genomeView.view.navToLocString("1:100..600"); // 在这里不能对genomeView进行处理，因为这个时候还没有new完成
        updates.innerHTML += JSON.stringify(patch) + '\n'
      },
    })

    function navTo(event) {
      genomeView.view.navToLocString(event.target.dataset.location)
    }
    const buttons = document.getElementsByTagName('button')
    for (const button of buttons) {
      if (button.dataset.type === 'gene_button') {
        button.addEventListener('click', navTo)
      }
    } const textArea = document.getElementById('viewstate')
    document.getElementById('showviewstate').addEventListener('click', () => {
      // textArea.innerHTML = JSON.stringify(genomeView.view.displayedRegions[0].refName, undefined, 2)
      textArea.innerHTML = JSON.stringify(genomeView.view, undefined, 2)
    })
  </script>
  <button id="showviewstate">Show view state</button>
  <textarea id="viewstate" name="viewstate" rows="20" cols="80"></textarea>
  <p>updates:</p>
  <textarea id="update" name="update" rows="5" cols="80" wrap="off"></textarea>
</body>

</html>